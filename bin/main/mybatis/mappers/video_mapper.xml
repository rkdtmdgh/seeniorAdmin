<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.see_nior.seeniorAdmin.video.mapper.VideoMapper">

	<resultMap type="DiseaseCategoryDto" id="DiseaseCategoryDto">
		<id column="dc_no" property="dc_no" />
		<result column="dc_name" property="dc_name" />		
		<result column="dc_is_deleted" property="dc_is_deleted" />
		<result column="dc_reg_date" property="dc_reg_date" />
		<result column="dc_mod_date" property="dc_mod_date" />
	</resultMap>

	<resultMap type="DiseaseDto" id="DiseaseDto">
		<id column="d_no" property="d_no" />
		<result column="d_category_no" property="d_category_no" />
		<result column="d_name" property="d_name" />
		<result column="d_info" property="d_info" />
		<result column="d_good_food" property="d_good_food" />
		<result column="d_bad_food" property="d_bad_food" />
		<result column="d_is_deleted" property="d_is_deleted" />
		<result column="d_reg_date" property="d_reg_date" />
		<result column="d_mod_date" property="d_mod_date" />
		<collection property="diseaseCategoryDto" resultMap="DiseaseCategoryDto" />
	</resultMap>

	<resultMap type="VideoDto" id="VideoDto">
		<id column="v_no" property="v_no"/>
		<result column="v_title" property="v_title"/>
		<result column="v_text" property="v_text"/>
		<result column="v_link" property="v_link"/>
		<result column="v_is_deleted" property="v_is_deleted"/>
		<result column="v_reg_date" property="v_reg_date"/>
		<result column="v_mod_date" property="v_mod_date"/>
		<collection property="diseaseDto" resultMap="DiseaseDto" />
	</resultMap>
	
	<select id="selectVideoList"
			resultMap="VideoDto">
			
		SELECT 
			* 
		FROM 
			VIDEO 
		WHERE 
			V_IS_DELETED = 1
		<choose>
			<when test="sortValue == 'v_no'">
				<choose>
					<when test="order == 'asc'">
						ORDER BY V_NO ASC
					</when>
					<when test="order == 'desc'">
						ORDER BY V_NO DESC
					</when>
				</choose>
			</when>
			<when test="sortValue == 'v_title'">
				<choose>
					<when test="order == 'asc'">
						ORDER BY V_TITLE ASC
					</when>
					<when test="order == 'desc'">
						ORDER BY V_TITLE DESC
					</when>
				</choose>
			</when>
		</choose>
		LIMIT 
			#{start}, #{limit}
		
	</select>
	
	<select id="selectAllVideoListCnt"
			resultType="Integer">
	
		SELECT 
			COUNT(V_NO) 
		FROM 
			VIDEO 
		WHERE 
			V_IS_DELETED = 1
	
	</select>
	
	<insert id="insertNewVideo">
	
		INSERT INTO 
			VIDEO(
				V_TITLE, 
				V_TEXT, 
				V_LINK
				) 
		VALUES(
			#{v_title}, 
			#{v_text}, 
			#{v_link}
			)
	
	</insert>
	
	<select id="selectSearchVideoList"
			resultMap="VideoDto">
			
		SELECT 
			* 
		FROM 
			VIDEO 
		WHERE 
			V_IS_DELETED = 1
		<if test="searchPart != null and searchString != null">
			AND #{searchPart} LIKE CONCAT('%', #{serachString}, '%')
		</if>
		<choose>
			<when test="sortValue == 'v_no'">
				<choose>
					<when test="order == 'asc'">
						ORDER BY V_NO ASC 
					</when>
					<when test="order == 'desc'">
						ORDER BY V_NO DESC 
					</when>
				</choose>
			</when>
			<when test="sortValue == 'v_title'">
				<choose>
					<when test="order == 'asc'">
						ORDER BY V_TITLE ASC 
					</when>
					<when test="order == 'desc'">
						ORDER BY V_TITLE DESC 
					</when>
				</choose>
			</when>
		</choose>
		LIMIT 
			#{start}, #{limit}
		
	</select>
	
	<select id="selectSearchVideoListCnt"
			resultType="Integer">
	
		SELECT 
			COUNT(V_NO) 
		FROM 
			VIDEO 
		WHERE 
			V_IS_DELETED = 1 
		<if test="searchPart != null and searchString != null">
			<choose>
				<when test="searchPart == 'v_title'">
					AND V_TITLE LIKE CONCAT('%', #{searchString}, '%')
				</when>
				<when test="searchPart == 'v_text'">
					AND V_TEXT LIKE CONCAT('%', #{searchString}, '%')
				</when>
			</choose>
		</if>
	
	</select>
	
</mapper>